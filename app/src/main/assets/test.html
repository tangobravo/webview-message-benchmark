<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebView Message Benchmark</title>
    <script>

(function() {
    var data = []
    var lastNow = 0;
    var receivedMessage = 0;

    function messageHandler(event) {
        if(event.data.length <= 5) {
            if(event.data === "start") {
                data = [];
                lastNow = performance.now();
            }
            if(event.data === "end") {
                outputResults();
            }
            return;
        }

        time = performance.now() - lastNow;
        data.push([event.data.length, time]);
        receivedMessage = event.data;
        lastNow = performance.now();
    }

    function outputResults() {
        var resultText = "";
        for(var i = 0; i < data.length; ++i) {
            resultText += data[i][0].toString() + " characters, " + data[i][1].toFixed(2) + " ms\n";
        }

        resultText += "\nFirst 10 code units:\n";
        for(var i = 0; i < 10; ++i) {
            resultText += i.toString() + ": 0x" + receivedMessage.charCodeAt(i).toString(16) + "\n";
        }
        resultText += "\n";

        document.getElementById("results").innerText = resultText;
    }

    window.addEventListener("message", messageHandler, false);
})();


    </script>

</head>

<body>
    <div id="results">
        Results will appear here.
    </div>
</body>

</html>
